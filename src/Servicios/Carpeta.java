/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package Servicios;
import java.awt.Dimension;
import java.awt.Toolkit;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.File;

/**
 *
 * @author Sistemas
 */
public class Carpeta extends javax.swing.JDialog implements MouseListener{

    /**
     * Creates new form Carpeta
     */
    private String carpeta="", local="";
    Hilo miHilo;
    int x=0;
    File[] ficheros;
    
    public Carpeta(java.awt.Frame parent, boolean modal, String carpeta) {
        super(parent, modal);
        carpeta=carpeta.replace("/", "\\");
        this.carpeta=carpeta;
        this.local=carpeta;
        initComponents();
        sp.getVerticalScrollBar().setUnitIncrement(50);
        miHilo = new Hilo(carpeta);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        t_ruta = new javax.swing.JTextField();
        b_atras = new javax.swing.JButton();
        sp = new javax.swing.JScrollPane();
        panel = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        barra = new javax.swing.JProgressBar();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setModalityType(java.awt.Dialog.ModalityType.APPLICATION_MODAL);
        setResizable(false);

        jLabel1.setText("Ruta:");

        t_ruta.setEditable(false);
        t_ruta.setBackground(new java.awt.Color(255, 255, 255));
        t_ruta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                t_rutaActionPerformed(evt);
            }
        });

        b_atras.setText("<-");
        b_atras.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                b_atrasActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(t_ruta, javax.swing.GroupLayout.DEFAULT_SIZE, 597, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(b_atras)
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(t_ruta, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(b_atras))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        getContentPane().add(jPanel1, java.awt.BorderLayout.PAGE_START);

        panel.setBackground(new java.awt.Color(255, 255, 255));
        sp.setViewportView(panel);

        getContentPane().add(sp, java.awt.BorderLayout.CENTER);

        barra.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        barra.setStringPainted(true);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addContainerGap(543, Short.MAX_VALUE)
                .addComponent(barra, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(barra, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        getContentPane().add(jPanel2, java.awt.BorderLayout.PAGE_END);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void b_atrasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_b_atrasActionPerformed
        // TODO add your handling code here:
        String texto=t_ruta.getText();
        if(texto.compareTo(local)!=0){
            File f=new File(texto);
            miHilo.t.stop();
            x=ficheros.length;
            String r=f.getParent().replace("/", "\\");
            miHilo = new Hilo(r+"\\");
        }
    }//GEN-LAST:event_b_atrasActionPerformed

    private void t_rutaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_rutaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_t_rutaActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton b_atras;
    private javax.swing.JProgressBar barra;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel panel;
    private javax.swing.JScrollPane sp;
    private javax.swing.JTextField t_ruta;
    // End of variables declaration//GEN-END:variables

    public void Listar(String directorio)
    {
        try{
            barra.setIndeterminate(true);
            barra.setString("Abriendo directorio epere");
            int l=panel.getComponentCount();
            panel.removeAll();
            panel.updateUI();
            panel.repaint();
            t_ruta.setText(directorio);
            File f = new File(directorio);
            if(f.exists())
            {
                ficheros = f.listFiles();
                int cantidad=ficheros.length;
                int valor=cantidad/4;
                panel.setSize(660, valor*120);
                panel.setPreferredSize(new Dimension(660, valor*120));
                for(x=0;x<cantidad;x++)
                {
                    if((ficheros[x].isDirectory()==true && ficheros[x].getName().contains("miniatura")!=true) || ficheros[x].getName().contains(".jpg")==true || ficheros[x].getName().contains(".JPG")==true || ficheros[x].getName().contains(".jpeg")==true || ficheros[x].getName().contains(".JPEG")==true)
                    {
                        vista elemento= new vista(ficheros[x].getName(), directorio);
                        elemento.addMouseListener(this);
                        panel.add(elemento);
                        elemento=null;
                    }
                }
            }
            panel.updateUI();
            panel.repaint();
           sp.updateUI();
           sp.revalidate();
           barra.setIndeterminate(false);
           barra.setString("Listo");
           f=null;
        }catch(Exception o){}
    }

    @Override
    public void mouseClicked(MouseEvent e) {
        //throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
        if(e.getClickCount()==2){
            try{
            vista comando = (vista)e.getSource();
            File f=new File(comando.ruta+comando.nombre);
            if(f.isDirectory()==true){
                miHilo = new Hilo(comando.ruta+comando.nombre+"\\");
            }
            else
            {
                ver aux=new ver(null, true, comando.ruta+comando.nombre);
                Dimension d = Toolkit.getDefaultToolkit().getScreenSize();
                aux.setLocation((d.width/2)-(aux.getWidth()/2), (d.height/2)-(aux.getHeight()/2));
                aux.setVisible(true);
                aux=null;
            }
            }catch(Exception ex){
                ex.printStackTrace();
            }
        }
    }

    @Override
    public void mousePressed(MouseEvent e) {
        try{
            
        }catch(Exception ex){}
    }

    @Override
    public void mouseReleased(MouseEvent e) {
        try{
            
        }catch(Exception ex){}
    }

    @Override
    public void mouseEntered(MouseEvent e) {
        try{
            
        }catch(Exception ex){}
    }

    @Override
    public void mouseExited(MouseEvent e) {
        try{
            
        }catch(Exception ex){}
    }
    
    public class Hilo implements Runnable
    {
        public Thread t;
        String ruta;
        public Hilo(String carpeta) 
        {
            t=new Thread(this,carpeta);
            ruta=carpeta;
            t.start();
        }
        @Override
        public void run() {
            Listar(ruta);
        }
    }
}
